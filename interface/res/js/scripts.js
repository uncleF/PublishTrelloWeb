!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(){navigator.serviceWorker.register("/service.js")}c.init=d},{}],2:[function(a,b,c){"use strict";function d(a,b,c){document.addEventListener?a.addEventListener(b,c):a.attachEvent("on"+b,c)}function e(a,b,c){document.removeEventListener?a.removeEventListener(b,c):a.detachEvent("on"+b,c)}function f(a,b,c){c=c||!1;var d;document.createEvent?(d=document.createEvent("MouseEvents"),d.initEvent(b,c,!1),a.dispatchEvent(d)):(d=document.createEventObject(),a.fireEvent("on"+b,d))}c.bind=d,c.unbind=e,c.trigger=f},{}],3:[function(a,b,c){"use strict";function d(a){function b(a){var b=e.className;a&&a.preventDefault(),e.className=b.indexOf(g)>-1?b.replace(g,""):b+" "+g}function c(a){var c=a.target?a.target:a.srcElement;c.className.indexOf(g)>-1&&b(a)}function d(){a&&(e=a,g=e.className.split(" ")[0]+"-is-active",f.bind(e,"click",c))}var e,g;return d(),{toggle:b}}function e(a){return new d(a)}var f=a("./tx-event");c.init=e},{"./tx-event":2}],4:[function(a,b,c){"use strict";function d(a){a.preventDefault(),h()}function e(a){h=a,n.bind(j,"click",m.toggle),n.bind(l,"click",d)}function f(a){a&&a.preventDefault(),m.toggle(),j.focus()}function g(){"authorizationHelp"===k.className?k.className="authorizationHelp authorizationHelp-is-invisible":k.className="authorizationHelp"}var h,i=document.getElementById("help"),j=document.getElementById("closeHelp"),k=document.getElementById("authorizationHelp"),l=document.getElementById("authorizationHelpToggle"),m=a("./components/tx-overlay.js").init(i),n=a("./components/tx-event.js");c.init=e,c.show=f,c.toggleHelp=g},{"./components/tx-event.js":2,"./components/tx-overlay.js":3}],5:[function(a,b,c){"use strict";function d(){k.bind(h,"click",j.toggle),k.bind(i,"click",j.toggle)}function e(a){g.textContent=a,j.toggle()}var f=document.getElementById("message"),g=document.getElementById("messageText"),h=document.getElementById("closeMessage"),i=document.getElementById("okMessage"),j=a("./components/tx-overlay.js").init(f),k=a("./components/tx-event.js");c.init=d,c.show=e},{"./components/tx-event.js":2,"./components/tx-overlay.js":3}],6:[function(a,b,c){"use strict";!function(){function b(){z.disabled=!z.disabled,z.className="download"}function c(){""!==y.value?y.value.match(E)?x.className="form form-is-validBoard":x.className="form form-is-invalidBoard":x.className="form"}function d(){x.reset(),c(),b()}function e(){b(),z.className="download download-is-busy"}function f(a,b){d(),window.location="/download?dir="+a+"&file="+b}function g(a,b){if(200===b.statusCode){var c=JSON.parse(b.responseText);f(c.dir,c.file)}else t.show("Something went wrong!")}function h(){var a=s(x,{hash:!0});return a.board=a.board.replace(/http.*\/b\//g,"").replace(/\/.*/g,""),a.token=Trello.token(),a}function i(){e(),r({method:"POST",uri:"/generate",body:h(),json:!0},g)}function j(){u.toggleHelp(),B.className="authorization authorization-is-authorized"}function k(){j(),i()}function l(){u.toggleHelp(),B.className="authorization authorization-is-unauthorized"}function m(a){var b;b=a?k:j,Trello.authorize({type:"popup",name:"Publish Trello",expiration:"never",success:b,error:l})}function n(a){a.preventDefault(),Trello.authorized()?i():m(!0)}function o(){"download download-is-busy"!==z.className&&z.disabled&&"form form-is-validBoard"===x.className&&(A.html.checked||A.md.checked||A.pdf.checked||A.epub.checked)?b():"download download-is-busy"===z.className||z.disabled||"form form-is-validBoard"===x.className&&(A.html.checked||A.md.checked||A.pdf.checked||A.epub.checked)||b()}function p(a){a.preventDefault(),Trello.authorized()||m()}function q(){var a="oninput"in window?"input":"keyup";Modernizr.serviceworker&&v.init(),Modernizr.localstorage&&localStorage[D]&&j(),t.init(),u.init(m),w.bind(x,"submit",n),w.bind(x,"change",o),w.bind(x,a,o),w.bind(y,"change",c),w.bind(y,a,c),w.bind(B,"click",p),w.bind(C,"click",u.show)}var r=a("browser-request"),s=a("form-serialize"),t=a("./messages"),u=a("./help"),v=a("./cache"),w=a("./components/tx-event.js"),x=document.getElementById("form"),y=document.getElementById("board"),z=document.getElementById("download"),A={html:document.getElementById("html"),md:document.getElementById("md"),pdf:document.getElementById("pdf"),epub:document.getElementById("epub")},B=document.getElementById("auth"),C=document.getElementById("helpToggle"),D="trello_token",E=new RegExp(/(?:^(?:https?:\/\/)?|^(?:w{3}\.)?|^(?:https?:\/\/w{3}\.)?)trello\.com\/b\//);q()}()},{"./cache":1,"./components/tx-event.js":2,"./help":4,"./messages":5,"browser-request":7,"form-serialize":8}],7:[function(a,b,c){!function(a,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof c?b.exports=d():a.returnExports=d()}(this,function(){function a(e,f){if("function"!=typeof f)throw new Error("Bad callback given: "+f);if(!e)throw new Error("No options given");var h=e.onResponse;if(e="string"==typeof e?{uri:e}:JSON.parse(JSON.stringify(e)),e.onResponse=h,e.verbose&&(a.log=d()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var i=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],j=0;j<i.length;j++)if(e[i[j]])throw new Error("options."+i[j]+" is not supported");if(e.callback=f,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||a.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!=typeof e.json?e.body=JSON.stringify(e.json):"string"!=typeof e.body&&(e.body=JSON.stringify(e.body)));var k=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};if(e.qs){var l="string"==typeof e.qs?e.qs:k(e.qs);-1!==e.uri.indexOf("?")?e.uri=e.uri+"&"+l:e.uri=e.uri+"?"+l}var m=function(a){var b={};b.boundry="-------------------------------"+Math.floor(1e9*Math.random());var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push("--"+b.boundry+'\nContent-Disposition: form-data; name="'+d+'"\n\n'+a[d]+"\n");return c.push("--"+b.boundry+"--"),b.body=c.join(""),b.length=b.body.length,b.type="multipart/form-data; boundary="+b.boundry,b};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var n=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=n,n){case"application/x-www-form-urlencoded":e.body=k(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var o=m(e.form);e.body=o.body,e.headers["content-type"]=o.type;break;default:throw new Error("unsupported encoding:"+n)}}}return e.onResponse=e.onResponse||c,e.onResponse===!0&&(e.onResponse=f,e.callback=c),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+g(e.auth.username+":"+e.auth.password)),b(e)}function b(b){function c(){l=!0;var c=new Error("ETIMEDOUT");return c.code="ETIMEDOUT",c.duration=b.timeout,a.log.error("Timeout",{id:k._id,milliseconds:b.timeout}),b.callback(c,k)}function d(c){if(l)return a.log.debug("Ignoring timed out state change",{state:k.readyState,id:k.id});if(a.log.debug("State change",{state:k.readyState,id:k.id,timed_out:l}),k.readyState===h.OPENED){a.log.debug("Request started",{id:k.id});for(var d in b.headers)k.setRequestHeader(d,b.headers[d])}else k.readyState===h.HEADERS_RECEIVED?e():k.readyState===h.LOADING?(e(),g()):k.readyState===h.DONE&&(e(),g(),i())}function e(){if(!p.response){if(p.response=!0,a.log.debug("Got response",{id:k.id,status:k.status}),clearTimeout(k.timeoutTimer),k.statusCode=k.status,m&&0==k.statusCode){var c=new Error("CORS request rejected: "+b.uri);return c.cors="rejected",p.loading=!0,p.end=!0,b.callback(c,k)}b.onResponse(null,k)}}function g(){p.loading||(p.loading=!0,a.log.debug("Response body loading",{id:k.id}))}function i(){if(!p.end){if(p.end=!0,a.log.debug("Request done",{id:k.id}),k.body=k.responseText,b.json)try{k.body=JSON.parse(k.responseText)}catch(c){return b.callback(c,k)}b.callback(null,k,k.body)}}var k=new h,l=!1,m=f(b.uri),n="withCredentials"in k;if(j+=1,k.seq_id=j,k.id=j+": "+b.method+" "+b.uri,k._id=k.id,m&&!n){var o=new Error("Browser does not support cross-origin request: "+b.uri);return o.cors="unsupported",b.callback(o,k)}k.timeoutTimer=setTimeout(c,b.timeout);var p={response:!1,loading:!1,end:!1};return k.onreadystatechange=d,k.open(b.method,b.uri,!0),m&&(k.withCredentials=!!b.withCredentials),k.send(b.body),k}function c(){}function d(){var a,b,d={},f=["trace","debug","info","warn","error"];for(b=0;b<f.length;b++)a=f[b],d[a]=c,"undefined"!=typeof console&&console&&console[a]&&(d[a]=e(console,a));return d}function e(a,b){function c(c,d){return"object"==typeof d&&(c+=" "+JSON.stringify(d)),a[b].call(a,c)}return c}function f(a){var b,c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{b=location.href}catch(d){b=document.createElement("a"),b.href="",b=b.href}var e=c.exec(b.toLowerCase())||[],f=c.exec(a.toLowerCase()),g=!(!f||f[1]==e[1]&&f[2]==e[2]&&(f[3]||("http:"===f[1]?80:443))==(e[3]||("http:"===e[1]?80:443)));return g}function g(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m}var h=XMLHttpRequest;if(!h)throw new Error("missing XMLHttpRequest");a.log={trace:c,debug:c,info:c,warn:c,error:c};var i=18e4,j=0;a.withCredentials=!1,a.DEFAULT_TIMEOUT=i,a.defaults=function(b,c){var d=function(a){var c=function(c,d){c="string"==typeof c?{uri:c}:JSON.parse(JSON.stringify(c));for(var e in b)void 0===c[e]&&(c[e]=b[e]);return a(c,d)};return c},e=d(a);return e.get=d(a.get),e.post=d(a.post),e.put=d(a.put),e.head=d(a.head),e};var k=["get","put","post","head"];return k.forEach(function(b){var c=b.toUpperCase(),d=b.toLowerCase();a[d]=function(b){"string"==typeof b?b={method:c,uri:b}:(b=JSON.parse(JSON.stringify(b)),b.method=c);var d=[b].concat(Array.prototype.slice.apply(arguments,[1]));return a.apply(this,d)}}),a.couch=function(b,d){function e(a,b,c){if(a)return d(a,b,c);if((b.statusCode<200||b.statusCode>299)&&c.error){a=new Error("CouchDB error: "+(c.error.reason||c.error.error));for(var e in c)a[e]=c[e];return d(a,b,c)}return d(a,b,c)}"string"==typeof b&&(b={uri:b}),b.json=!0,b.body&&(b.json=b.body),delete b.body,d=d||c;var f=a(b,e);return f},a})},{}],8:[function(a,b,c){function d(a,b){"object"!=typeof b?b={hash:!!b}:void 0===b.hash&&(b.hash=!0);for(var c=b.hash?{}:"",d=b.serializer||(b.hash?g:h),e=a&&a.elements?a.elements:[],f=Object.create(null),k=0;k<e.length;++k){var l=e[k];if((b.disabled||!l.disabled)&&l.name&&j.test(l.nodeName)&&!i.test(l.type)){var m=l.name,n=l.value;if("checkbox"!==l.type&&"radio"!==l.type||l.checked||(n=void 0),b.empty){if("checkbox"!==l.type||l.checked||(n=""),"radio"===l.type&&(f[l.name]||l.checked?l.checked&&(f[l.name]=!0):f[l.name]=!1),!n&&"radio"==l.type)continue}else if(!n)continue;if("select-multiple"!==l.type)c=d(c,m,n);else{n=[];for(var o=l.options,p=!1,q=0;q<o.length;++q){var r=o[q],s=b.empty&&!r.value,t=r.value||s;r.selected&&t&&(p=!0,c=b.hash&&"[]"!==m.slice(m.length-2)?d(c,m+"[]",r.value):d(c,m,r.value))}!p&&b.empty&&(c=d(c,m,""))}}}if(b.empty)for(var m in f)f[m]||(c=d(c,m,""));return c}function e(a){var b=[],c=/^([^\[\]]*)/,d=new RegExp(k),e=c.exec(a);for(e[1]&&b.push(e[1]);null!==(e=d.exec(a));)b.push(e[1]);return b}function f(a,b,c){if(0===b.length)return a=c;var d=b.shift(),e=d.match(/^\[(.+?)\]$/);if("[]"===d)return a=a||[],Array.isArray(a)?a.push(f(null,b,c)):(a._values=a._values||[],a._values.push(f(null,b,c))),a;if(e){var g=e[1],h=parseInt(g,10);isNaN(h)?(a=a||{},a[g]=f(a[g],b,c)):(a=a||[],a[h]=f(a[h],b,c))}else a[d]=f(a[d],b,c);return a}function g(a,b,c){var d=b.match(k);if(d){var g=e(b);f(a,g,c)}else{var h=a[b];h?(Array.isArray(h)||(a[b]=[h]),a[b].push(c)):a[b]=c}return a}function h(a,b,c){return c=c.replace(/(\r)?\n/g,"\r\n"),c=encodeURIComponent(c),c=c.replace(/%20/g,"+"),a+(a?"&":"")+encodeURIComponent(b)+"="+c}var i=/^(?:submit|button|image|reset|file)$/i,j=/^(?:input|select|textarea|keygen)/i,k=/(\[[^\[\]]*\])/g;b.exports=d},{}]},{},[6]);